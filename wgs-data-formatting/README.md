# eQTL Workflow Scripts

## Overview

This repository contains scripts for formatting eQTL data and performing related analyses. The scripts are designed to run on a SLURM cluster. They perform tasks such as transforming genotype data, preparing data for ASeq and CSeQTL analyses, and managing job dependencies.

---

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Scripts](#scripts)
    - [2_eqtl_format_submit.sh](#2_eqtl_format_submitsh)
    - [2_eqtl-format-pt1.sh](#2_eqtl-format-pt1sh)
    - [2_eqtl-format-cseqtl-pt2.sh](#2_eqtl-format-cseqtl-pt2sh)
    - [2_eqtl-format-aseq-pt3.sh](#2_eqtl-format-aseq-pt3sh)
3. [How to Run](#how-to-run)
4. [Output Files](#output-files)

---

## Prerequisites

- Linux/Unix operating system
- SLURM job scheduler
- BCFtools module
- Input directory should contain a file named `lls_sample_array_input.csv`
  
---

## Scripts

### 2_eqtl_format_submit.sh

#### Description
The main script to submit jobs for eQTL data formatting. This script loops through specified chromosomes and submits parallel jobs to perform formatting tasks on bcf files for aseq/cseqtl analysis.

#### Variables
- `IN_DIR`: Input directory path.
- `SCRIPT_DIR`: Directory where the other scripts are stored.
- `chromosomes`: Array of chromosome numbers to be processed.

#### Usage
Run this script to initiate the entire workflow.

---

### 2_eqtl-format-pt1.sh

#### Description
This script takes bcf files that have been split by chromosome and creates two intermediate files:
1) ASeq counting (sample_hap_chr.txt)
2) CSeQTL genotype files (chr_temp_snp_data.txt).

#### Variables
- `chr`: Chromosome number passed from the main script.
- `GENO_FILE`: The base name of the genotype file.
- `IN_DIR`: Input directory.
- `OUT_DIR`: Output directory for haplotype files.

#### Usage
This script is called by `2_eqtl_format_submit.sh`.

---

### 2_eqtl-format-cseqtl-pt2.sh

#### Description
This script creates per-SNP files for CSeQTL analysis.It aggregates genotype data stored in chr_temp_snp_data.txt by SNP site.

#### Variables
- `chr`: Chromosome number.
- `input_file`: Temporary SNP data file to read.

#### Usage
This script is called by `2_eqtl_format_submit.sh` and is dependent on the successful completion of `2_eqtl-format-pt1.sh`.

---

### 2_eqtl-format-aseq-pt3.sh

#### Description
This script concatenates haplotype files which have been split per chromosome/individual, into files grouped per individual (with all chromosome data).

#### Variables
- `SAMPLE_NAME`: Identifier for the sample.
- `IN_DIR`: Input directory for haplotype files.
- `OUT_DIR`: Output directory for concatenated haplotype files.

#### Usage
This script is called by `2_eqtl_format_submit.sh` and is dependent on the successful completion of `2_eqtl-format-pt1.sh`.

---

## How to Run

1. Navigate to the directory containing the scripts.
2. Ensure submission script is executable (chmod +x submit.sh)
3. Run `2_eqtl_format_submit.sh` to initiate the workflow.

---

## Output Files

- Individual haplotype files per chromosome in the directory specified by `OUT_DIR`.
- SNP files generated by `2_eqtl-format-cseqtl-pt2.sh`.
- Concatenated haplotype files generated by `2_eqtl-format-aseq-pt3.sh`.

---
### Contact

For any questions or issues, please contact mjohnso5@fredhutch.org.
